<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Trading Game</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <h1>Crypto Trading Game</h1>

        <div id="auth">
            <h2>Login / Register</h2>
            <form id="auth-form">
                <input type="text" id="username" placeholder="Username" required>
                <input type="password" id="password" placeholder="Password" required>
                <button type="submit">Login</button>
            </form>
            <p id="auth-message"></p>
        </div>

        <div id="game" style="display: none;">
            <h2>Welcome, <span id="player-name"></span></h2>
            <p>Balance: <span id="balance">$0</span></p>

            <div id="crypto">
                <h3>Crypto Market</h3>
                <p>Current Price: $<span id="crypto-price">0</span></p>

                <form id="trade-form">
                    <input type="number" id="trade-amount" placeholder="Amount" required>
                    <button type="button" id="buy-button">Buy</button>
                    <button type="button" id="sell-button">Sell</button>
                </form>
            </div>

            <div id="chart">
                <h3>Price Chart</h3>
                <canvas id="price-chart"></canvas>
            </div>

            <button id="logout-button">Logout</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const authForm = document.getElementById('auth-form');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const authMessage = document.getElementById('auth-message');
        const gameSection = document.getElementById('game');
        const authSection = document.getElementById('auth');
        const playerName = document.getElementById('player-name');
        const balanceDisplay = document.getElementById('balance');
        const cryptoPriceDisplay = document.getElementById('crypto-price');
        const tradeForm = document.getElementById('trade-form');
        const tradeAmountInput = document.getElementById('trade-amount');
        const buyButton = document.getElementById('buy-button');
        const sellButton = document.getElementById('sell-button');
        const logoutButton = document.getElementById('logout-button');

        const priceChartCanvas = document.getElementById('price-chart');
        const chartData = [];
        let balance = 1000;
        let cryptoPrice = 100;
        let chart;

        function updateUI() {
            balanceDisplay.textContent = `$${balance}`;
            cryptoPriceDisplay.textContent = `${cryptoPrice}`;
        }

        function updateChart() {
            const now = new Date();
            chartData.push({ x: now, y: cryptoPrice });
            if (chartData.length > 20) chartData.shift();
            chart.update();
        }

        function generateRandomPrice() {
            const change = (Math.random() - 0.5) * 10;
            cryptoPrice = Math.max(1, cryptoPrice + change);
        }

        function setupChart() {
            chart = new Chart(priceChartCanvas, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'Crypto Price',
                            data: chartData,
                            borderColor: 'blue',
                            fill: false,
                        },
                    ],
                },
                options: {
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'second',
                            },
                        },
                        y: {
                            beginAtZero: true,
                        },
                    },
                },
            });
        }

        authForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const username = usernameInput.value;
            const password = passwordInput.value;

            fetch('/auth', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ username, password }),
            })
                .then((response) => response.json())
                .then((data) => {
                    if (data.success) {
                        authSection.style.display = 'none';
                        gameSection.style.display = 'block';
                        playerName.textContent = username;
                        balance = data.balance;
                        updateUI();
                        setupChart();
                        setInterval(() => {
                            generateRandomPrice();
                            updateUI();
                            updateChart();
                        }, 2000);
                    } else {
                        authMessage.textContent = data.message;
                    }
                });
        });

        buyButton.addEventListener('click', () => {
            const amount = parseFloat(tradeAmountInput.value);
            if (isNaN(amount) || amount <= 0 || balance < amount * cryptoPrice) return;
            balance -= amount * cryptoPrice;
            updateUI();
        });

        sellButton.addEventListener('click', () => {
            const amount = parseFloat(tradeAmountInput.value);
            if (isNaN(amount) || amount <= 0) return;
            balance += amount * cryptoPrice;
            updateUI();
        });

        logoutButton.addEventListener('click', () => {
            authSection.style.display = 'block';
            gameSection.style.display = 'none';
            authForm.reset();
        });
    </script>
</body>
</html>

