<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Криптобиржа</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #121212;
            color: #ffffff;
        }
        canvas {
            max-width: 600px;
            margin: auto;
        }
        #top-bar {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            background-color: #1e1e1e;
            padding: 10px;
            border-radius: 10px;
        }
        #history {
            margin-top: 20px;
            max-width: 600px;
            margin: auto;
            text-align: left;
            background-color: #1e1e1e;
            padding: 10px;
            border-radius: 10px;
        }
        select, button, input {
            background-color: #1e1e1e;
            color: #ffffff;
            border: 1px solid #ffffff;
            border-radius: 5px;
            padding: 5px 10px;
            margin: 5px;
        }
    </style>
</head>
<body>
    <div id="login-form">
        <h2>Вход</h2>
        <input type="text" id="username" placeholder="Логин">
        <input type="password" id="password" placeholder="Пароль">
        <button onclick="login()">Войти</button>
        <button onclick="register()">Зарегистрироваться</button>
    </div>

    <div id="main-content" style="display: none;">
        <div id="top-bar">
            <div>Пользователь: <span id="current-user"></span></div>
            <div>Баланс: <span id="balance">0</span> USD</div>
            <div>BTC: <span id="crypto-btc">0</span></div>
            <div>ETH: <span id="crypto-eth">0</span></div>
            <div>ADA: <span id="crypto-ada">0</span></div>
        </div>

        <h1>Криптобиржа</h1>
        <div>
            <label for="currency">Выберите криптовалюту:</label>
            <select id="currency" onchange="changeCurrency()">
                <option value="btc">BTC</option>
                <option value="eth">ETH</option>
                <option value="ada">ADA</option>
            </select>
        </div>

        <canvas id="chart"></canvas>

        <button onclick="buyCryptoMax()">Купить максимум</button>
        <button onclick="sellCrypto()">Продать</button>

        <div id="history">
            <h3>История операций:</h3>
            <ul id="history-list"></ul>
        </div>
    </div>

    <script>
        const ctx = document.getElementById('chart').getContext('2d');

        const labels = [];
        const prices = [];

        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Цена BTC/USD',
                    data: prices,
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Время',
                            color: '#ffffff'
                        },
                        ticks: {
                            color: '#ffffff'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Цена (USD)',
                            color: '#ffffff'
                        },
                        ticks: {
                            color: '#ffffff'
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: '#ffffff'
                        }
                    }
                }
            }
        });

        let currentUser = null;
        let currentCurrency = 'btc';
        let currentPrice = 100;

        async function fetchPrices() {
            try {
                const response = await fetch('https://your-server.herokuapp.com/get_prices');  // Замените на URL вашего сервера
                const data = await response.json();
                for (const key in data) {
                    data[key] = (data[key] * (0.95 + Math.random() * 0.1)).toFixed(2);
                }
                currentPrice = data[currentCurrency];
                prices.push(currentPrice);
                labels.push(new Date().toLocaleTimeString());

                if (prices.length > 10) {
                    prices.shift();
                    labels.shift();
                }

                chart.data.labels = labels;
                chart.data.datasets[0].data = prices;
                chart.update();
            } catch (error) {
                console.error('Ошибка при получении цен:', error);
            }
        }

        function updateUI(data) {
            document.getElementById('current-user').textContent = data.username;
            document.getElementById('balance').textContent = data.balance;
            document.getElementById('crypto-btc').textContent = data.crypto.btc;
            document.getElementById('crypto-eth').textContent = data.crypto.eth;
            document.getElementById('crypto-ada').textContent = data.crypto.ada;
        }

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            fetch(`https://your-server.herokuapp.com/login?username=${username}&password=${password}`)
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        currentUser = data;
                        document.getElementById('login-form').style.display = 'none';
                        document.getElementById('main-content').style.display = 'block';
                        updateUI(data);
                    } else {
                        alert(data.message);
                    }
                });
        }

        function register() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            fetch(`https://your-server.herokuapp.com/register?username=${username}&password=${password}`)
                .then(res => res.json())
                .then(data => {
                    alert(data.message);
                });
        }

        setInterval(fetchPrices, 1000);
    </script>
</body>
</html>

